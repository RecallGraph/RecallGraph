<!DOCTYPE html>
<html lang="en">
<head><title>lib/routes/history/kShortestPaths</title></head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type">
<meta content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0" name="viewport">
<meta content="../../../" name="groc-relative-root">
<meta content="lib/routes/history/kShortestPaths" name="groc-document-path">
<meta content="lib/routes/history/kShortestPaths.js" name="groc-project-path">
<meta content="https://github.com/RecallGraph/RecallGraph" name="groc-github-url">
<link href="../../../assets/style.css" media="all" rel="stylesheet" type="text/css">
<script src="../../../assets/behavior.js" type="text/javascript"></script>
<body>
<div id="meta">
    <div class="file-path"><a
            href="https://github.com/RecallGraph/RecallGraph/blob/master/lib/routes/history/kShortestPaths.js">lib/routes/history/kShortestPaths.js</a>
    </div>
</div>
<div id="document">
    <div class="segment">
        <div class="code">
            <div class="wrapper"><span class="hljs-pi">'use strict'</span>

                <span class="hljs-keyword">const</span> { JoiRG } = <span class="hljs-built_in">require</span>(<span
                        class="hljs-string">'../helpers'</span>)
                <span class="hljs-keyword">const</span> { KSP_BODY_SCHEMA } = <span class="hljs-built_in">require</span>(<span
                        class="hljs-string">'../schemas'</span>)
                <span class="hljs-keyword">const</span> { kShortestPaths } = <span class="hljs-built_in">require</span>(<span
                        class="hljs-string">'../../handlers/kShortestPathsHandlers'</span>)
                <span class="hljs-keyword">const</span> { DOC_ID_REGEX } = <span
                        class="hljs-built_in">require</span>(<span class="hljs-string">'../../constants'</span>)
                <span class="hljs-keyword">const</span> dd = <span class="hljs-built_in">require</span>(<span
                        class="hljs-string">'dedent'</span>)

                <span class="hljs-built_in">module</span>.exports = router =&gt; {
                buildEndpoint(router.post(<span class="hljs-string">'/kShortestPaths'</span>, processKspRequest, <span
                        class="hljs-string">'kShortestPathsPost'</span>))
                .body(KSP_BODY_SCHEMA, dd<span class="hljs-string">`
      The edge collections to traverse along with their specified directions, the filter expressions to apply on the
      traversed vertices and edges, and the weight expression to evaluate cost per edge.
      (e.g. \`{
        "edges": { "edge_collection_1": "inbound", "edge_collection_2": "outbound", "edge_collection_3": "any" },
        "vFilter": "x == 2 &amp;&amp; y &lt; 1",
        "eFilter": "x == 2 &amp;&amp; y &lt; 1",
        "weightExpr": "x ** 2 + y ** 2"
      }\`)
    `</span>)

                .summary(<span class="hljs-string">'k shortest historic paths between vertices.'</span>)

                <span class="hljs-built_in">console</span>.debug(<span class="hljs-string">'Loaded "kShortestPaths" routes'</span>)
                }

                <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">processKspRequest</span> (<span
                        class="hljs-params">req, res</span>) </span>{
                res.status(<span class="hljs-number">200</span>).json(kShortestPaths(req))
                }

                <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">buildEndpoint</span> (<span
                        class="hljs-params">endpoint</span>) </span>{
                <span class="hljs-keyword">return</span> endpoint
                .queryParam(<span class="hljs-string">'timestamp'</span>, JoiRG.number(), dd<span class="hljs-string">`
      The unix timestamp (sec) for which to traverse node states. Precision: 0.1Î¼s. Example: since=1581583228.2800217.
      Default: Current Time
    `</span>)

                .queryParam(<span class="hljs-string">'svid'</span>, JoiRG.string().regex(DOC_ID_REGEX).required(),
                <span class="hljs-string">'The id of the starting vertex from which to begin traversal".'</span>)

                .queryParam(<span class="hljs-string">'evid'</span>, JoiRG.string().regex(DOC_ID_REGEX).required(),
                <span class="hljs-string">'The id of the ending vertex at which to end traversal".'</span>)

                .queryParam(<span class="hljs-string">'depth'</span>, JoiRG.number().integer().min(<span
                        class="hljs-number">1</span>),
                <span class="hljs-string">'The max depth to which the traversal should execute. Default: `1`'</span>)

                .queryParam(<span class="hljs-string">'skip'</span>, JoiRG.number().integer().min(<span
                        class="hljs-number">0</span>),
                <span class="hljs-string">'The number of paths to skip. Default: `0`'</span>)

                .queryParam(<span class="hljs-string">'limit'</span>, JoiRG.number().integer().min(<span
                        class="hljs-number">1</span>),
                <span class="hljs-string">'The max number of shortest paths to return. Default: `1`'</span>)

                .response(<span class="hljs-number">200</span>, [<span class="hljs-string">'application/json'</span>],
                <span class="hljs-string">'The historic paths were successfully traversed and filtered.'</span>)
                .error(<span class="hljs-number">400</span>, <span class="hljs-string">'Invalid request body/params. Response body contains the error details.'</span>)
                .error(<span class="hljs-number">500</span>, <span class="hljs-string">'The operation failed.'</span>)

                .description(dd<span class="hljs-string">`
      Returns k shortest historic paths between vertices, matching the given filters.

      Also see: https://docs.recallgraph.tech/getting-started/terminology/post-filters
    `</span>)

                .tag(<span class="hljs-string">'History'</span>)
                }
            </div>
        </div>
    </div>
</div>
</body>
</html>