<!DOCTYPE html>
<html lang="en">
<head><title>lib/routes/event/commit</title></head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type">
<meta content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0" name="viewport">
<meta content="../../../" name="groc-relative-root">
<meta content="lib/routes/event/commit" name="groc-document-path">
<meta content="lib/routes/event/commit.js" name="groc-project-path">
<meta content="https://github.com/RecallGraph/RecallGraph" name="groc-github-url">
<link href="../../../assets/style.css" media="all" rel="stylesheet" type="text/css">
<script src="../../../assets/behavior.js" type="text/javascript"></script>
<body>
<div id="meta">
    <div class="file-path"><a href="https://github.com/RecallGraph/RecallGraph/blob/master/lib/routes/event/commit.js">lib/routes/event/commit.js</a>
    </div>
</div>
<div id="document">
    <div class="segment">
        <div class="code">
            <div class="wrapper"><span class="hljs-pi">'use strict'</span>

                <span class="hljs-keyword">const</span> Joi = <span class="hljs-built_in">require</span>(<span
                        class="hljs-string">'joi'</span>)
                <span class="hljs-keyword">const</span> { commit } = <span class="hljs-built_in">require</span>(<span
                        class="hljs-string">'../../handlers/commitHandlers'</span>)
                <span class="hljs-keyword">const</span> { PATH_SCHEMA, TYPE_SCHEMA } = <span class="hljs-built_in">require</span>(<span
                        class="hljs-string">'../schemas'</span>)
                <span class="hljs-keyword">const</span> dd = <span class="hljs-built_in">require</span>(<span
                        class="hljs-string">'dedent'</span>)

                <span class="hljs-built_in">module</span>.exports = router =&gt; {
                <span class="hljs-keyword">const</span> reqBodySchema = Joi.object().keys({
                path: PATH_SCHEMA,
                types: TYPE_SCHEMA
                })

                buildEndpoint(router.put(<span class="hljs-string">'/commit'</span>, processCommitRequest, <span
                        class="hljs-string">'commit'</span>))
                .body(reqBodySchema, dd<span class="hljs-string">`
      The path pattern to pick nodes whose logs should be returned, and the optional types of nodes which should be
      committed. **Important:** This endpoint DOES NOT accept the Node-Glob scope in the path pattern.
      (e.g. \`{"path": "/c/*raw_data*", "types": ["existing"]}\`)
    `</span>)

                .summary(<span class="hljs-string">'Commit nodes having states that are AHEAD of the log.'</span>)

                <span class="hljs-built_in">console</span>.debug(<span
                        class="hljs-string">'Loaded "commit" routes.'</span>)
                }

                <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">processCommitRequest</span> (<span
                        class="hljs-params">req, res</span>) </span>{
                res.status(<span class="hljs-number">200</span>).json(commit(req))
                }

                <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">buildEndpoint</span> (<span
                        class="hljs-params">endpoint</span>) </span>{
                <span class="hljs-keyword">return</span> endpoint
                .response(<span class="hljs-number">200</span>, [<span class="hljs-string">'application/json'</span>],
                <span class="hljs-string">'The commit was successfully performed.'</span>)
                .error(<span class="hljs-number">400</span>, <span class="hljs-string">'Invalid request body/params. Response body contains the error details.'</span>)
                .error(<span class="hljs-number">500</span>, <span class="hljs-string">'The operation failed.'</span>)

                .description(dd<span class="hljs-string">`
      Comits nodes to the event log whose states no longer match with the log.
      
      **This endpoint DOES NOT accept the Node-Glob scope in the path pattern.**
      
      Two types of commits are supported:
      
      1. Existing nodes that are yet to be tracked by the event log, or are tracked but have been modified outside
        of RecallGraph's purview, and hence have gone out of sync with its event log.
      2. Tracked nodes that have been deleted through means outside of RecallGraph, and so the event log still believes
        them to exist.

      Also see:

      1. https://docs.recallgraph.tech/getting-started/terminology#event

      2. https://docs.recallgraph.tech/getting-started/terminology#path

      3. https://docs.recallgraph.tech/understanding-recallgraph/terminology#node-glob-scope
    `</span>)

                .tag(<span class="hljs-string">'Event'</span>)
                }
            </div>
        </div>
    </div>
</div>
</body>
</html>