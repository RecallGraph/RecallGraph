<!DOCTYPE html><html lang="en"><head><title>lib/routes/schemas</title></head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"><meta name="groc-relative-root" content="../../"><meta name="groc-document-path" content="lib/routes/schemas"><meta name="groc-project-path" content="lib/routes/schemas.js"><meta name="groc-github-url" content="https://github.com/RecallGraph/RecallGraph"><link rel="stylesheet" type="text/css" media="all" href="../../assets/style.css"><script type="text/javascript" src="../../assets/behavior.js"></script><body><div id="meta"><div class="file-path"><a href="https://github.com/RecallGraph/RecallGraph/blob/master/lib/routes/schemas.js">lib/routes/schemas.js</a></div></div><div id="document"><div class="segment"><div class="code"><div class="wrapper"><span class="hljs-pi">'use strict'</span>

<span class="hljs-keyword">const</span> { JoiRG } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./helpers'</span>)
<span class="hljs-keyword">const</span> { makeRe } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'minimatch'</span>)
<span class="hljs-keyword">const</span> {
  getDBScope, getGraphScope, getCollectionScope, getNodeGlobScope, getNodeBraceScope
} = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../operations/helpers'</span>)
<span class="hljs-keyword">const</span> { DOC_KEY_REGEX, DOC_ID_REGEX, SYNC_TYPES: { EXISTING, DELETED } } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../constants'</span>)</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Private</p></div></div><div class="code"><div class="wrapper"><span class="hljs-keyword">const</span> createObjSchema = JoiRG.object().keys({
  _from: JoiRG.string().regex(DOC_ID_REGEX).required(),
  _to: JoiRG.string().regex(DOC_ID_REGEX).required()
}).unknown(<span class="hljs-literal">true</span>).optionalKeys(<span class="hljs-string">'_from'</span>, <span class="hljs-string">'_to'</span>).with(<span class="hljs-string">'_from'</span>, <span class="hljs-string">'_to'</span>).with(<span class="hljs-string">'_to'</span>, <span class="hljs-string">'_from'</span>)
<span class="hljs-keyword">const</span> createArrSchema = JoiRG.array().items(createObjSchema.required()).min(<span class="hljs-number">1</span>)

<span class="hljs-keyword">const</span> updateObjSchema = JoiRG.object().keys({
  _key: JoiRG.string().regex(DOC_KEY_REGEX).required(),
  _id: JoiRG.string().regex(DOC_ID_REGEX).required(),
  _from: JoiRG.string().regex(DOC_ID_REGEX).required(),
  _to: JoiRG.string().regex(DOC_ID_REGEX).required()
}).unknown(<span class="hljs-literal">true</span>).or(<span class="hljs-string">'_key'</span>, <span class="hljs-string">'_id'</span>).optionalKeys(<span class="hljs-string">'_from'</span>, <span class="hljs-string">'_to'</span>, <span class="hljs-string">'_key'</span>, <span class="hljs-string">'_id'</span>)
<span class="hljs-keyword">const</span> updateArrSchema = JoiRG.array().items(updateObjSchema.required()).min(<span class="hljs-number">1</span>)

<span class="hljs-keyword">const</span> removeObjSchema = JoiRG.object().keys({
  _key: JoiRG.string().regex(DOC_KEY_REGEX).required(),
  _id: JoiRG.string().regex(DOC_ID_REGEX).required()
})
  .unknown(<span class="hljs-literal">true</span>).or(<span class="hljs-string">'_key'</span>, <span class="hljs-string">'_id'</span>).optionalKeys(<span class="hljs-string">'_key'</span>, <span class="hljs-string">'_id'</span>)
<span class="hljs-keyword">const</span> removeArrSchema = JoiRG.array().items(removeObjSchema.required()).min(<span class="hljs-number">1</span>)

<span class="hljs-keyword">const</span> traverseBaseSchema = JoiRG.object().keys({
  edges: JoiRG.object().pattern(<span class="hljs-regexp">/^/</span>, JoiRG.string().valid(<span class="hljs-string">'inbound'</span>, <span class="hljs-string">'outbound'</span>, <span class="hljs-string">'any'</span>)).min(<span class="hljs-number">1</span>).required(),
  vFilter: JoiRG.string().filter().empty(<span class="hljs-string">''</span>),
  eFilter: JoiRG.string().filter().empty(<span class="hljs-string">''</span>)
})

<span class="hljs-keyword">const</span> dbSchema = JoiRG.string().regex(makeRe(getDBScope().pathPattern))
<span class="hljs-keyword">const</span> graphSchema = JoiRG.string().regex(makeRe(getGraphScope().pathPattern))
<span class="hljs-keyword">const</span> collSchema = JoiRG.string().regex(makeRe(getCollectionScope().pathPattern))
<span class="hljs-keyword">const</span> nodeGlobSchema = JoiRG.string().regex(makeRe(getNodeGlobScope().pathPattern))
<span class="hljs-keyword">const</span> nodeBraceSchema = JoiRG.string().regex(makeRe(getNodeBraceScope().pathPattern))</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Public</p></div></div><div class="code"><div class="wrapper"><span class="hljs-keyword">const</span> CREATE_BODY_SCHEMA = JoiRG.alternatives().try(createObjSchema, createArrSchema).required()
<span class="hljs-keyword">const</span> UPDATE_BODY_SCHEMA = JoiRG.alternatives().try(updateObjSchema, updateArrSchema).required()
<span class="hljs-keyword">const</span> REMOVE_BODY_SCHEMA = JoiRG.alternatives().try(removeObjSchema, removeArrSchema).required()
<span class="hljs-keyword">const</span> TRAVERSE_BODY_SCHEMA = traverseBaseSchema.concat(JoiRG.object().keys({
  pFilter: JoiRG.string().filter().empty(<span class="hljs-string">''</span>)
}))
<span class="hljs-keyword">const</span> KSP_BODY_SCHEMA = traverseBaseSchema.concat(JoiRG.object().keys({
  weightExpr: JoiRG.string().filter().empty(<span class="hljs-string">''</span>)
}))

<span class="hljs-keyword">const</span> PATH_SCHEMA = JoiRG.alternatives()
  .try(dbSchema, graphSchema, collSchema, nodeGlobSchema, nodeBraceSchema)
  .required()

<span class="hljs-keyword">const</span> TYPE_SCHEMA = JoiRG.array()
  .items(JoiRG.string().valid(EXISTING, DELETED))
  .min(<span class="hljs-number">1</span>)
  .max(<span class="hljs-number">2</span>)
  .unique()

<span class="hljs-built_in">module</span>.exports = {
  CREATE_BODY_SCHEMA,
  UPDATE_BODY_SCHEMA,
  REMOVE_BODY_SCHEMA,
  TRAVERSE_BODY_SCHEMA,
  KSP_BODY_SCHEMA,
  PATH_SCHEMA,
  TYPE_SCHEMA
}</div></div></div></div></body></html>